syntax = "proto3";

package com.duan.session;

import "com/duan/session/session.proto";
import "com/duan/session/user_session.proto";

message Response {
    bool success = 1;
    string msg = 2;
    int32 code = 3;
    OneOfPayload payload = 4;
}

message OneOfPayload {
    JoinResponse join_response = 1;
    RefreshStatusResponse refresh_status_response = 2;
    PauseResponse pause_response = 3;
    LeaveResponse leave_response = 4;
    UserCountInSessionResponse user_count_in_session_response = 5;
}

message UserSessionData {
    Session session = 1;
    UserSession user = 2;
}

message JoinRequest {
    string session_id = 1;
    string user_id = 2;
}

message JoinResponse {
    UserSessionData user_session = 1;
}

message PauseResponse {
    UserSessionData user_session = 1;
}

message LeaveRequest {
    string session_id = 1;
    string user_id = 2;
}

message LeaveResponse {
    UserSessionData user_session = 1;
}

message RefreshStatusRequest {
    string session_id = 1;
    string user_id = 2;
}

message RefreshStatusResponse {
    UserSessionData user_session = 1;
}

message PauseRequest {
    string session_id = 1;
    string user_id = 2;
}

message UserCountInSessionRequest {
    string session_id = 1;
}

message UserCountInSessionResponse {
    int32 count = 1;
}

service SessionService {

    // only count user_session.status is OPEN and PENDING
    rpc UserCountInSession (UserCountInSessionRequest) returns (Response) {
    }

    rpc Join (JoinRequest) returns (Response) {
    }

    // if in pending, will reactive, update reactive_time
    rpc RefreshStatus (RefreshStatusRequest) returns (Response) {
    }

    rpc Pause (PauseRequest) returns (Response) {
    }

    rpc Leave (LeaveRequest) returns (Response) {
        // option (google.api.http) = {
        //   post: "/v1alpha1/insertData"
        //   body: "*"
        // };
    }
}