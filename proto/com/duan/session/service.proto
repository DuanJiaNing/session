syntax = "proto3";

package com.duan.session;

import "com/duan/session/session.proto";
import "com/duan/session/user_session.proto";

message UserSessionData {
    Session session = 1;
    UserSession user = 2;
}

message JoinRequest {
    int64 session_id = 1;
    string user_id = 2;
}

message JoinResponse {
    UserSessionData user_session = 1;
}

message LeaveRequest {
    int64 session_id = 1;
    string user_id = 2;
}

message LeaveResponse {
    UserSessionData user_session = 1;
}

message RefreshStatusRequest {
    int64 session_id = 1;
    string user_id = 2;
}

message RefreshStatusResponse {
    UserSessionData user_session = 1;
}

message PauseRequest {
    int64 session_id = 1;
    string user_id = 2;
}

message PauseResponse {
    UserSessionData user_session = 1;
}

message UserCountInSessionRequest {
    int64 session_id = 1;
}

message UserCountInSessionResponse {
    int32 count = 1;
}

message CreateRequest {
    SessionType type = 1;
    string topic = 2;
}

message CreateResponse {
    int64 session_id = 1;
}

message OpenRequest {
    int64 session_id = 2;
}

message OpenResponse {
    SessionStatus status = 1;
    int64 session_id = 2;
}

message CloseRequest {
    int64 session_id = 2;
}

message CloseResponse {
    SessionStatus status = 1;
    int64 session_id = 2;
}

service SessionService {

    rpc Create (CreateRequest) returns (CreateResponse) {
    }

    rpc Open (OpenRequest) returns (OpenResponse) {
    }

    rpc Close (CloseRequest) returns (CloseResponse) {
    }

    // only count user_session.status is OPEN and PENDING
    rpc UserCountInSession (UserCountInSessionRequest) returns (UserCountInSessionResponse) {
    }

    rpc Join (JoinRequest) returns (JoinResponse) {
    }

    // if in pending, will reactive, update reactive_time
    rpc RefreshStatus (RefreshStatusRequest) returns (RefreshStatusResponse) {
    }

    rpc Pause (PauseRequest) returns (PauseResponse) {
    }

    rpc Leave (LeaveRequest) returns (LeaveResponse) {
    }
}